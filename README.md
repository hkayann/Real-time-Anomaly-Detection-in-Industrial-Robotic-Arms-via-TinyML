# Real-time Anomaly Detection in Industrial Robotic Arms via TinyML

![Project Status](https://img.shields.io/badge/status-active-green.svg)
![License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/Python-3.8%2B-yellow.svg)
![TinyML](https://img.shields.io/badge/TinyML-powered-red.svg)
![Nicla Sense ME](https://img.shields.io/badge/Nicla%20Sense%20ME-supported-purple.svg)

This repository contains the work on detecting anomalies in industrial robotic arms using the Nicla Sense ME for TinyML applications. It includes scripts for cloud and edge computing, datasets, datasheets, and Jupyter notebooks for data analysis and model demonstrations.

## Introduction

This project demonstrates real-time anomaly detection in industrial robotic arms using **TinyML** and **edge computing**. By leveraging the **Nicla Sense ME**, we developed models that detect movement-based anomalies locally on the device, ensuring minimal latency and improved safety in industrial settings.

**Key Technologies Used:**
- TinyML (TensorFlow Lite Micro)
- Embedded Systems (Nicla Sense ME)
- Machine Learning (1D-CNN, LSTM (performs best), XGBOOST, One-class SVM)
- Real-Time Data Processing (RTDE with Universal Robots)
- Over-the-Air (OTA) Updates via Bluetooth Low Energy (BLE)
- Python (Data Processing & Model Training)

## Directory Structure

| Directory        | Description                                                                                      |
|------------------|--------------------------------------------------------------------------------------------------|
| `ota_scripts/` | Scripts for managing over-the-air firmware update for Nicla over BLE.      |
| `datasets/`      | Datasets used or generated by the project, including raw data, processed data, and metadata.    |
| `edge_scripts/`  | Scripts tailored for edge devices, focusing on low latency and local processing.                 |
| `figures/`       | Graphical figures or images used in documentation or results presentation.                       |
| `libs/`          | Library code the project depends upon or provides, including third-party and custom libraries.  |
| `notebooks/`     | Jupyter notebooks with code, visualizations, and narrative for data analysis and model demos.    |
| `rtde/`          | Scripts and configurations required to run RTDE (Real-Time Data Exchange) experiments with Universal Robots, enabling real-time communication and control for the experiments.    |

## Project Overview

This project aims to leverage the power of TinyML for real-time anomaly detection in industrial robotic arms, enhancing efficiency and safety in manufacturing environments. Utilizing the Nicla Sense ME, we develop and deploy models capable of identifying deviations from normal operations directly on the device, ensuring immediate response and minimal downtime.

## Demo Video

[![Watch the video](https://img.youtube.com/vi/ShW2_ZVlFpc/0.jpg)](https://www.youtube.com/watch?v=ShW2_ZVlFpc)

## Getting Started

### 1. Clone the Repository

```sh
git clone https://github.com/hkayann/Real-time-Anomaly-Detection-in-Industrial-Robotic-Arms-via-TinyML.git
cd Real-time-Anomaly-Detection-in-Industrial-Robotic-Arms-via-TinyML
```

### 2. Install Dependencies

You should have Python 3.8+ installed, then install the required dependencies:

```sh
pip install -r requirements.txt
```

### 3. Dataset

Download the dataset from Kaggle:

[Industrial Robotic Arm IMU Data (CASPER-1 & CASPER-2)](https://www.kaggle.com/datasets/hkayan/industrial-robotic-arm-imu-data-casper-1-and-2)

Once downloaded, extract the dataset and place it inside the `datasets/` directory.

## System Architecture for Real-Time Anomaly Detection

![System Setup](figures/systemSetup.png)

This project implements **real-time anomaly detection** in industrial robotic arms using **TinyML** on **Nicla Sense ME**. The system is designed to detect **joint velocity deviations** and **external disruptions (environmental or operational interference)**.

### 1. Model Training & Joint Velocity Anomaly Detection
- A **1D-CNN/LSTM model** is trained on **24 hours of non-anomalous IMU data** collected from robotic arm movements.
- The dataset is split into **training (60%)**, **validation (20%)**, and **test (20%)** sets.
- **Feature engineering** includes accelerometer, gyroscope, and magnetometer data processing with **Madgwick and Mahony filters**.
- The model is optimized through **hyperparameter tuning** and evaluated using **Root Mean Square Error (RMSE)**.
- This phase primarily focuses on detecting **joint velocity changes** to ensure the robotic arm operates within expected motion parameters.

### 2. Anomaly Detection for External Disruptions
- The trained model is deployed for real-time anomaly detection on **2 hours of anomalous IMU data**.
- This phase identifies **external disruptions** affecting robotic performance, including:
  - **Simulated earthquake** (environmental disturbance)
  - **External impacts** (hitting the arm, hitting the platform)
  - **Additional weight changes** (unexpected load variations)
  - **Magnetic field interference** (sensor disturbances)
- Anomalies are detected when the **RMSE exceeds a predefined threshold (TH)** to classify movements as either **normal** or **anomalous**.

### 3. Real-Time Processing & Deployment
- The final model is deployed on **Nicla Sense ME** using **TensorFlow Lite Micro**.
- The system integrates with **RTDE (Real-Time Data Exchange) for Universal Robots**, enabling real-time data collection and inference.
- Over-the-air (**OTA**) firmware updates allow continuous model improvements without physical access to the device. You have to use our custom firmware to do OTA. 

## Citing this Work

If you use any code, datasets, or methods from this repository in your research or projects, please cite our work:

```bibtex
@article{10.1145/3670414,
author = {Kayan, Hakan and Heartfield, Ryan and Rana, Omer and Burnap, Pete and Perera, Charith},
title = {CASPER: Context-Aware IoT Anomaly Detection System for Industrial Robotic Arms},
year = {2024},
issue_date = {August 2024},
publisher = {Association for Computing Machinery},
address = {New York, NY, USA},
volume = {5},
number = {3},
url = {https://doi.org/10.1145/3670414},
doi = {10.1145/3670414},
month = aug,
articleno = {18},
numpages = {36},
keywords = {Neural networks, anomaly detection, industrial robotic arms, cyber-physical systems, ubiquitous computing}
}
```


## Contact Information

For any inquiries or further information, please contact me at:

- **Hakan Kayan** - [kayanh@cardiff.ac.uk](mailto:kayanh@cardiff.ac.uk)
